<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ËÅäÂ§©ÂÆ§</title>
    <style>
        body {
            background-color: rgb(138, 135, 135);

        }

        ul,
        li,
        a {
            list-style: none;
        }

        .box {
            width: 750px;
            height: 600px;
            border: 1px solid #eee;
            background-color: #eee;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .emoji-content {

            position: absolute;
            left: 30px;
            top: 160px;
            width: 300px;
            height: 250px;
            background-color: rgb(247, 244, 244);
            display: none;
        }

        .emoji-content .emo-box {
            display: flex;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
        }



        .emo-box li {
            display: block;
            width: 25px;
            height: 25px;
            line-height: 25px;
            text-align: center;
            border: 1px solid transparent;
        }

        .emo-box li:hover {
            border: 1px solid rgb(10, 10, 10);
            cursor: pointer;
        }

        .title {
            padding-left: 20px;
            height: 30px;
            line-height: 30px;
            font-size: 16px;
            font-weight: 800;
            background-color: rgba(219, 216, 216, .5);
        }


        .task-box {
            display: flex;
            flex-direction: column;
            border: 1px solid black;
            background-color: #fff;
            width: 500px;
            height: 370px;
            margin: 20px 20px 0 20px;
        }

        .task-box span {
            color: gray;
            font-size: 12px;
            padding: 5px;
        }

        .task-box .name {
            color: rgb(56, 84, 227);
            display: block;
            height: 5px;
            line-height: 5px;

        }

        .additional-box {
            height: 30px;
            line-height: 30px;
        }

        .additional-box div {
            text-align: center;
            margin-left: 20px;
            width: 30px;
        }

        .additional-box div:hover {
            border: 1px solid #fff;
        }

        .input-box {
            display: flex;
            flex-direction: column;
        }

        .input-box textarea {
            width: 500px;
            height: 100px;
            margin-left: 20px;

            font-size: 18px;
        }

        .input-box .button-box {
            margin-left: 340px;
            height: 40px;
            line-height: 40px;
        }

        .input-box .button-box button {
            width: 80px;
            height: 30px;
            border: 1px solid #fff;
            background: linear-gradient(#eee, rgb(180, 179, 179), rgb(217, 215, 215));
        }

        .input-box .button-box button:hover {
            border: 1px solid rgb(15, 15, 15);
            box-shadow: 0 0 3px 1px rgb(94, 92, 92);
        }

        .input-box .button-box button:nth-child(2) {
            margin-left: 20px;
        }

        .right-box {
            font-size: 15px;
        }

        .user-list {
            height: 400px;
            width: 200px;
            background-color: #fff;
            border: 1px solid black;
        }

        .now-user {
            margin-top: 10px;
        }

        .now-user .user {
            margin: 10px 0 0 50px;
            color: black;
        }

        /* .task-box span {
            margin-top: 5px;
        } */
    </style>

</head>

<body>

    <div class="box">
        <div class="emoji-content">
            <ul class="emo-box"></ul>
        </div>
        <div class="title">209ËÅäÂ§©ÂÆ§</div>
        <div class="content-box" style="display: flex;">
            <div class="left-box" style="flex: 2;">
                <div class="task-box">
                </div>
                <div class="additional-box">

                    <div class="emoji-button">üòÄ</div>
                </div>
                <div class="input-box">
                    <textarea style="resize:none;"></textarea>
                    <div class="button-box">
                        <button>ÂèñÊ∂à</button>
                        <button>ÂèëÈÄÅ</button>
                    </div>
                </div>
            </div>

            <div class="right-box" style="flex: 1;">
                <div class="online-user-num"> Âú®Á∫øÁî®Êà∑ÂàóË°®ÔºàÔºâ</div>
                <div class="user-list">

                </div>
                <div class="now-user">
                    <div>ÂΩìÂâçÁî®Êà∑Ôºö</div>

                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        // Ëß£Á†ÅÁôªÂΩïÁïåÈù¢‰º†ÈÄíÁöÑÂßìÂêç
        const nickName = decodeURIComponent(location.search.split("&")[0].split("=")[1]); //Ëß£Á†ÅÊòµÁß∞
        const roomName = decodeURIComponent(location.search.split("&")[1].split("=")[1]); //Ëß£Á†ÅÊàøÈó¥Âêç
        const clientId = Date.now();
        const socket = io.connect("http://127.0.0.1:3002", { query: { roomName, clientId } }); //ÈìæÊé•ÊúçÂä°Á´Ø
        const title = document.querySelector(".title") //Ëé∑ÂèñÊ†áÈ¢ò
        const taskBox = document.querySelector(".task-box"); //Ëé∑ÂèñË∞àËØùÊ°Ü
        const textarea = document.querySelector("textarea"); //Ëé∑ÂèñËæìÂÖ•Ê°Ü
        const userList = document.querySelector(".user-list"); //Ëé∑ÂèñÂú®Á∫øÂàóË°®
        const onlineUserNum = document.querySelector(".online-user-num"); //Ëé∑ÂèñÊòæÁ§∫Âú®Á∫ø‰∫∫Êï∞
        const nowUser = document.querySelector(".now-user"); //ÂΩìÂâçÁî®Êà∑
        const cancelButton = document.querySelectorAll("button")[0]; //Ëé∑ÂèñÂèñÊ∂àÊåâÈíÆ
        const sendButton = document.querySelectorAll("button")[1]; //Ëé∑ÂèñÂèëÈÄÅÊåâÈíÆ
        const emojiButton = document.querySelector(".emoji-button") //Ëé∑ÂèñË°®ÊÉÖÂåÖ‰∏ªÊåâÈíÆ
        const emojiContent = document.querySelector(".emoji-content") //Ëé∑ÂèñË°®ÊÉÖÂåÖÈÅÆÁΩ©
        const emoBox = document.querySelector(".emo-box") //Ëé∑ÂèñË°®ÊÉÖÂåÖÊòæÁ§∫ÁïåÈù¢

        // ÈîôËØØÂ§ÑÁêÜ
        socket.on("error", (err) => {
            alert(err)
        })

        const onlinesUserLists = [];//Âú®Á∫øÁî®Êà∑ÂàóË°®
        let emoList = [] //Ë°®ÊÉÖÂåÖÂàóË°®
        window.onload = () => {
            // Ëé∑ÂèñË°®ÊÉÖÂåÖ
            socket.on("getEmoList", (data) => {
                emoList = data.emoList
            })
            // ÊòæÁ§∫Ê†áÈ¢ò
            title.innerText = `${roomName}ËÅäÂ§©ÂÆ§`
            //ÊòæÁ§∫ÂΩìÂâçÁî®Êà∑
            const div = document.createElement("div");
            div.setAttribute("class", "user");
            div.innerText = `‚ù§ ${nickName} ‚ù§`;
            nowUser.append(div);

            // ÂΩìÁïåÈù¢Âä†ËΩΩÊó∂ ÂèëÈÄÅÁî®Êà∑‰ø°ÊÅØ Ëá≥ÊúçÂä°Âô®
            socket.emit("loginUser", { nickName, clientId });
            socket.on("hello", (data) => {
                // ÊòæÁ§∫ËÅäÂ§©‰ø°ÊÅØ
                const span = document.createElement("span");
                span.innerText = `Á≥ªÁªüÂÖ¨ÂëäÔºö${data.msg}...`;
                // Â∞ÜÂàõÂª∫ÁöÑÂÖÉÁ¥†Ê∑ªÂä†Ëá≥ËÅäÂ§©Ê°Ü
                taskBox.append(span);
                // ÊòæÁ§∫Âú®Á∫ø‰∫∫Êï∞Êï∞Èáè
                onlineUserNum.innerText = `ÂΩìÂâçÂú®Á∫ø‰∫∫Êï∞ (${data.onlineUserNum}) `;
                // ÂÖàÊ∏ÖÈô§ÂàóË°®
                userList.innerHTML = "";
                data.userList.forEach((item) => {
                    // ÊòæÁ§∫Âú®Á∫ø‰∫∫Êï∞ÂàóË°®
                    const div = document.createElement("div");
                    div.innerText = item.nickName;
                    userList.append(div);
                });
            });
        };

        //Ë°®ÊÉÖÂåÖÊåâÈíÆ
        emojiButton.onclick = () => {
            if (emojiContent.style.display == "none") {
                emojiContent.style.display = "block"
                emoList.forEach(item => {
                    const li = document.createElement("li")
                    li.setAttribute("class", "emo-item")
                    li.innerText = item.emo
                    // Ê∑ªÂä†Ë°®ÊÉÖ
                    li.onclick = () => {
                        textarea.value += item.emo
                    }
                    emoBox.append(li)
                })

            } else {
                emojiContent.style.display = "none"
                // Âà†Èô§Â≠êËäÇÁÇπ
                emoBox.innerHTML = ''
            }
        }

        // ÂèñÊ∂àÊåâÈíÆ‰∫ã‰ª∂
        cancelButton.onclick = () => {
            textarea.value = "";
        };
        // ÂèëÈÄÅÊåâÈíÆ‰∫ã‰ª∂
        sendButton.onclick = () => {
            if (textarea.value === "") {
                textarea.value = "ËØ∑ËæìÂÖ•‰ø°ÊÅØ";
            } else {
                socket.emit("exchange", { nickName: nickName, msg: textarea.value });
                textarea.value = "";
            }
        };

        // Ë∞àËØùÂäüËÉΩ
        socket.on("getMessage", (data) => {
            const span = document.createElement("span");
            span.setAttribute("class", "name");
            span.innerText = `${data.nickName}       ${data.time} `;
            taskBox.append(span);
            const span1 = document.createElement("span");
            span1.innerText = data.msg;
            taskBox.append(span1);
        });

        // ÁõëÂê¨ÈÄÄÂá∫‰∫ã‰ª∂
        socket.on("signOut", (data) => {
            // ÊòæÁ§∫ËÅäÂ§©‰ø°ÊÅØ
            const span = document.createElement("span");
            span.innerText = `Á≥ªÁªüÂÖ¨ÂëäÔºö${data.msg}...`;
            // Â∞ÜÂàõÂª∫ÁöÑÂÖÉÁ¥†Ê∑ªÂä†Ëá≥ËÅäÂ§©Ê°Ü
            taskBox.append(span);

            // ÊòæÁ§∫Âú®Á∫ø‰∫∫Êï∞Êï∞Èáè
            onlineUserNum.innerText = `ÂΩìÂâçÂú®Á∫ø‰∫∫Êï∞ (${data.onlineUserNum}) `;
            // ÂÖàÊ∏ÖÈô§ÂàóË°®
            userList.innerHTML = "";
            data.userList.forEach((item) => {
                // ÊòæÁ§∫Âú®Á∫ø‰∫∫Êï∞ÂàóË°®
                const div = document.createElement("div");
                div.innerText = item.nickName;
                userList.append(div);
            });
        });

    </script>
</body>

</html>